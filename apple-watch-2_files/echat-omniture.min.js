var counter = !1, proActiveCounter = !1, newSessionAgent = !1, newSessionMsg = !1, newSessionMinimize = !1, newSessionStartOver = !1, newSessionChatTranscript = !1, newSessionClose = !1, newSessionsocketConnected = !1, chatdetails = ""; function getOmnitureCookie(e) { let t = {}; return document.cookie.split(";").forEach(function (e) { var n = e.split("=")[0], o = e.split("=")[1]; t[n.trim()] = o }), t[e] } var socketConnected = "", isChatOpen = "", isChatAgentConnected = "", chatId = "", engagementId = "", chatEngineType = "", clickedStartOver = !1, isChatActive = "", chatEntry = "", pageCategory = "", isProactive = "", proactiveType = "", omnitureCookieNames = ["__csomni", "__ceidomni", "__cacomni", "__cminomni", "__cromni", "__ctromni", "__cepomni", "__cpcpomni", "__cabomni", "__cpaomni"]; setInterval(function () { null != getOmnitureCookie("__cwss") && null != getOmnitureCookie("__cwss") && "" != getOmnitureCookie("__cwss") && (socketConnected = getOmnitureCookie("__cwss")), null != getOmnitureCookie("__cwof") && null != getOmnitureCookie("__cwof") && "" != getOmnitureCookie("__cwof") && (isChatOpen = getOmnitureCookie("__cwof")), isChatAgentConnected = getOmnitureCookie("__caf"), engagementId = isChatAgentConnected && null != getOmnitureCookie("__cpseid") && null != getOmnitureCookie("__cpseid") && "" != getOmnitureCookie("__cpseid") ? getOmnitureCookie("__cpseid") : "NA", chatId = null != getOmnitureCookie("__csid") && null != getOmnitureCookie("__csid") && "" != getOmnitureCookie("__csid") ? getOmnitureCookie("__csid") : "NA", null != getOmnitureCookie("__cepomni") && "" != getOmnitureCookie("__cepomni") && null != getOmnitureCookie("__cepomni") && (chatEntry = getOmnitureCookie("__cepomni")), pageCategory = null != getOmnitureCookie("__cpcpomni") && null != getOmnitureCookie("__cpcpomni") && "" != getOmnitureCookie("__cpcpomni") ? getOmnitureCookie("__cpcpomni") : "NA", null != getOmnitureCookie("__cpaomni") && null != getOmnitureCookie("__cpaomni") && "" != getOmnitureCookie("__cpaomni") && (isProactive = getOmnitureCookie("__cpaomni")), null != getOmnitureCookie("__cwpsa") && null != getOmnitureCookie("__cwpsa") && "" != getOmnitureCookie("__cwpsa") && (proactiveType = getOmnitureCookie("__cwpsa")), null != getOmnitureCookie("__cwt") && null != getOmnitureCookie("__cwt") && "" != getOmnitureCookie("__cwt") && (chatTranscript = getOmnitureCookie("__cwt")) }, 2e3); var paType = "", chatAvailableck = !1; function EchatPayloadCall(e, t) { var n = getOmnitureCookie("__cabomni"); (chatAvailableck = "965-0-0" == n) || (setTimeout(function () { 1 === $("#eChat_B_GA").length && !1 === counter && ("function" == typeof s_oTrackPage && s_oTrackPage({ s_oLSTB: "Chat~" + e + "~G~" + t + "~eChat_B_GA~R", s_oAPT: "965-0-0" }), counter = !0) }, 3e3), setTimeout(function () { 1 === $("#btnPaSubtle").length && !1 === proActiveCounter && ("function" == typeof s_oTrackPage && s_oTrackPage({ s_oLSTB: "Chat~" + e + "~G~" + t + "~eChat_B_GA~PS", s_oAPT: "965-0-0" }), proActiveCounter = !0) }, 36e3), setTimeout(function () { 1 === $("#btnPaAggressive").length && !1 === proActiveCounter && ("function" == typeof s_oTrackPage && s_oTrackPage({ s_oLSTB: "Chat~" + e + "~G~" + t + "~eChat_B_GA~PA", s_oAPT: "965-0-0" }), proActiveCounter = !0) }, 36e3)) } var entryPointID = ""; function getChatButtonType(e) { switch (e) { case "eChat_Bell_ContactUs_MOB": case "eChat_Bell_ContactUs_INT": case "eChat_Bell_ContactUs_TV": case "eChat_Bell_ContactUs_HP": case "eChat_Bell_MOB_Escalations": case "eChat_Bell_BRS_Escalations": case "eChat_Bell_EPP": return "F"; case "eChat_B_GA": default: return "G" } } function getPosition(e) { switch (e) { case "eChat_Bell_ContactUs_MOB": return "T1"; case "eChat_Bell_ContactUs_INT": return "T2"; case "eChat_Bell_ContactUs_TV": return "T3"; case "eChat_Bell_ContactUs_HP": return "T4"; case "eChat_Bell_MOB_Escalations": return "T1"; case "eChat_Bell_BRS_Escalations": return "T2"; case "eChat_Bell_EPP": return "C1"; case "eChat_B_GA": default: return "BR" } } var omnitureInterval, position = "", chatButtonType = ""; function getEntryPoint() { entryPointID = null != chatEntry && null != chatEntry && "" != chatEntry ? chatEntry : "eChat_B_GA" } function NewSessionPayloadCall(e, t) { getEntryPoint(), pageCategory = setPageCategory(e), position = getPosition(entryPointID), chatButtonType = getChatButtonType(entryPointID); var n = { attributes: !0, childList: !0, characterData: !0 }; const o = new MutationObserver(function (e) { for (var t = e.length, n = e[t - 1], i = 0; i < n.addedNodes.length; i++)if (!n.addedNodes[i].contains(document.querySelector("#agentTypingDots"))) { var c = getOmnitureCookie("__ceidomni"); newSessionAgent = "966-0-0" == c, engagementId = isChatAgentConnected && null != getOmnitureCookie("__cpseid") && null != getOmnitureCookie("__cpseid") && "" != getOmnitureCookie("__cpseid") ? getOmnitureCookie("__cpseid") : "NA", chatId = null != getOmnitureCookie("__csid") && null != getOmnitureCookie("__csid") && null != getOmnitureCookie("__csid") ? getOmnitureCookie("__csid") : "NA", newSessionAgent || "true" !== isChatAgentConnected || (setOmnitureCookie("__ceidomni", "966-0-0"), s_oTrackPage({ s_oChat: chatId + "~" + engagementId + "~" + pageCategory + "~" + chatButtonType + "~" + position + "~Agent~" + entryPointID + "~" + isProactive + "~NA~CA", s_oAPT: "966-0-0", s_oAJC: !0 }), newSessionAgent = !0, o.disconnect(), clearInterval(omnitureInterval)) } }); $(document).ready(function () { $(document).on("click", ".echat-send-button", function () { var e = getOmnitureCookie("__csomni"); newSessionMsg = "967-0-0" == e, chatId = null != getOmnitureCookie("__csid") && null != getOmnitureCookie("__csid") && "" != getOmnitureCookie("__csid") ? getOmnitureCookie("__csid") : "NA", newSessionMsg || (null != proactiveType && null != proactiveType && "" != proactiveType ? (entryPointID = setEntryPointCookie("eChat_B_GA"), setOmnitureCookie("__cpaomni", isProactive = proactiveType)) : setOmnitureCookie("__cpaomni", isProactive = "R"), setOmnitureCookie("__csomni", "967-0-0"), s_oTrackPage({ s_oChat: chatId + "~" + engagementId + "~" + pageCategory + "~" + chatButtonType + "~" + position + "~Bot~" + entryPointID + "~" + isProactive + "~NA~CS", s_oAPT: "967-0-0", s_oAJC: !0 }), newSessionMsg = !0) }), $(document).on("click", ".eChat-agent-text-button-small, .echat-blue-button-text, .eChat-secondaryCta, .eChat-agent-text-card", function () { var e = getOmnitureCookie("__csomni"); newSessionMsg = "967-0-0" == e, chatId = null != getOmnitureCookie("__csid") && null != getOmnitureCookie("__csid") && "" != getOmnitureCookie("__csid") ? getOmnitureCookie("__csid") : "NA", newSessionMsg || (null != proactiveType && null != proactiveType && "" != proactiveType ? (entryPointID = setEntryPointCookie("eChat_B_GA"), setOmnitureCookie("__cpaomni", isProactive = proactiveType)) : setOmnitureCookie("__cpaomni", isProactive = "R"), setOmnitureCookie("__csomni", "967-0-0"), s_oTrackPage({ s_oChat: chatId + "~" + engagementId + "~" + pageCategory + "~" + chatButtonType + "~" + position + "~Bot~" + entryPointID + "~" + isProactive + "~NA~CS", s_oAPT: "967-0-0", s_oAJC: !0 }), newSessionMsg = !0) }) }), $(document).on("click", "#closechatSessionButton", function () { "968-0-0" == getOmnitureCookie("__cacomni") ? (newSessionClose = !0, newSessionsocketConnected = !0) : newSessionsocketConnected = !1, chatEngineType = "true" !== isChatAgentConnected && "True" !== isChatAgentConnected || null == isChatAgentConnected || null == isChatAgentConnected || "" == isChatAgentConnected ? "Bot" : "Agent", newSessionClose || newSessionsocketConnected ? (proactiveType = "R", deleteOmnitureCookies(), newSessionClose = !0, newSessionsocketConnected = !0) : (s_oTrackPage({ s_oChat: chatId + "~" + engagementId + "~" + pageCategory + "~" + chatButtonType + "~" + position + "~" + chatEngineType + "~" + entryPointID + "~" + isProactive + "~user~CC", s_oAPT: "968-0-0", s_oAJC: !0 }), newSessionClose = !0, newSessionsocketConnected = !0, proactiveType = "R", deleteOmnitureCookies()) }), omnitureInterval = setInterval(function () { if ("true" !== isChatAgentConnected && "True" !== isChatAgentConnected || null == isChatAgentConnected || null == isChatAgentConnected || "" == isChatAgentConnected || (engagementId = null != getOmnitureCookie("__cpseid") && null != getOmnitureCookie("__cpseid") && "" != getOmnitureCookie("__cpseid") ? getOmnitureCookie("__cpseid") : "NA", $(document).on("click", ".echat-send-button", function () { var e = getOmnitureCookie("__ceidomni"); newSessionAgent = "966-0-0" == e, chatId = null != getOmnitureCookie("__csid") && null != getOmnitureCookie("__csid") && "" != getOmnitureCookie("__csid") ? getOmnitureCookie("__csid") : "NA", newSessionAgent || "true" !== isChatAgentConnected || (setOmnitureCookie("__ceidomni", "966-0-0"), s_oTrackPage({ s_oChat: chatId + "~" + engagementId + "~" + pageCategory + "~" + chatButtonType + "~" + position + "~Agent~" + entryPointID + "~" + isProactive + "~NA~CA", s_oAPT: "966-0-0", s_oAJC: !0 }), newSessionAgent = !0, clearInterval(omnitureInterval)) }), $(document).on("DOMSubtreeModified", "#messages", function () { var e = document.querySelector("#msgWindowHeight"); o.observe(e, n) })), "false" === socketConnected && "true" === isChatOpen) { var e = getOmnitureCookie("__cacomni"); newSessionsocketConnected = "968-0-0" == e, chatId = null != getOmnitureCookie("__csid") && null != getOmnitureCookie("__csid") && "" != getOmnitureCookie("__csid") ? getOmnitureCookie("__csid") : "NA", null != getOmnitureCookie("__cwf") && null != getOmnitureCookie("__cwf") && "" != getOmnitureCookie("__cwf") && (isChatActive = getOmnitureCookie("__cwf")), chatEngineType = "true" !== isChatAgentConnected && "True" !== isChatAgentConnected || null == isChatAgentConnected || null == isChatAgentConnected || "" == isChatAgentConnected ? "Bot" : "Agent", newSessionsocketConnected || "true" != isChatActive || (setOmnitureCookie("__cacomni", "968-0-0"), s_oTrackPage({ s_oChat: chatId + "~" + engagementId + "~" + pageCategory + "~" + chatButtonType + "~" + position + "~" + chatEngineType + "~" + entryPointID + "~" + isProactive + "~Auto~CC", s_oAPT: "968-0-0", s_oAJC: !0 }), newSessionsocketConnected = !0, clearInterval(omnitureInterval)) } }, 2e3), $(document).on("click", "#minimizeChatWindowBtn", function () { var e = getOmnitureCookie("__cminomni"); newSessionMinimize = "969-0-0" == e, chatId = null != getOmnitureCookie("__csid") && null != getOmnitureCookie("__csid") && "" != getOmnitureCookie("__csid") ? getOmnitureCookie("__csid") : "NA", chatEngineType = "true" !== isChatAgentConnected && "True" !== isChatAgentConnected || null == isChatAgentConnected || null == isChatAgentConnected || "" == isChatAgentConnected ? "Bot" : "Agent", newSessionMinimize || (setOmnitureCookie("__cminomni", "969-0-0"), s_oTrackPage({ s_oChat: chatId + "~" + engagementId + "~" + pageCategory + "~" + chatButtonType + "~" + position + "~" + chatEngineType + "~" + entryPointID + "~" + isProactive + "~NA~CM", s_oAPT: "969-0-0", s_oAJC: !0 }), newSessionMinimize = !0) }), $(document).on("click", "#minimizeChevronDownBtn", function () { var e = getOmnitureCookie("__cminomni"); newSessionMinimize = "969-0-0" == e, chatId = null != getOmnitureCookie("__csid") && null != getOmnitureCookie("__csid") && "" != getOmnitureCookie("__csid") ? getOmnitureCookie("__csid") : "NA", chatEngineType = "true" !== isChatAgentConnected && "True" !== isChatAgentConnected || null == isChatAgentConnected || null == isChatAgentConnected || "" == isChatAgentConnected ? "Bot" : "Agent", newSessionMinimize || (null != proactiveType && null != proactiveType && "" != proactiveType ? (entryPointID = setEntryPointCookie("eChat_B_GA"), setOmnitureCookie("__cpaomni", isProactive = proactiveType)) : setOmnitureCookie("__cpaomni", isProactive = "R"), setOmnitureCookie("__cminomni", "969-0-0"), s_oTrackPage({ s_oChat: chatId + "~" + engagementId + "~" + pageCategory + "~" + chatButtonType + "~" + position + "~" + chatEngineType + "~" + entryPointID + "~" + isProactive + "~NA~CM", s_oAPT: "969-0-0", s_oAJC: !0 }), newSessionMinimize = !0) }), $(document).on("click", "#startOver", function () { clickedStartOver = !0 }), $(document).on("click", "#ButtonYes", function () { var e = getOmnitureCookie("__cromni"); newSessionStartOver = "970-0-0" == e, chatId = null != getOmnitureCookie("__csid") && null != getOmnitureCookie("__csid") && "" != getOmnitureCookie("__csid") ? getOmnitureCookie("__csid") : "NA", !newSessionStartOver && clickedStartOver && (setOmnitureCookie("__cromni", "970-0-0"), s_oTrackPage({ s_oChat: chatId + "~" + engagementId + "~" + pageCategory + "~" + chatButtonType + "~" + position + "~Bot~" + entryPointID + "~" + isProactive + "~NA~CR", s_oAPT: "970-0-0", s_oAJC: !0 }), newSessionStartOver = !0, clickedStartOver = !1) }), $(document).on("click", "#ButtonNo", function () { chatId = null != getOmnitureCookie("__csid") && null != getOmnitureCookie("__csid") && "" != getOmnitureCookie("__csid") ? getOmnitureCookie("__csid") : "NA", !newSessionStartOver && clickedStartOver && (clickedStartOver = !1) }), $(document).on("click", "#btnSubmitTranscriptRequest", function () { setTimeout(function () { if (!$("#chatTranscriptPanel").is(":visible")) { var e = getOmnitureCookie("__ctromni"); newSessionChatTranscript = "971-0-0" == e, chatId = null != getOmnitureCookie("__csid") && null != getOmnitureCookie("__csid") && "" != getOmnitureCookie("__csid") ? getOmnitureCookie("__csid") : "NA", newSessionChatTranscript || (setOmnitureCookie("__ctromni", "971-0-0"), s_oTrackPage({ s_oChat: chatId + "~" + engagementId + "~" + pageCategory + "~" + chatButtonType + "~" + position + "~Agent~" + entryPointID + "~" + isProactive + "~NA~CT", s_oAPT: "971-0-0", s_oAJC: !0 }), newSessionChatTranscript = !0) } }, 1e3) }), t || (newSessionAgent = !1, newSessionMsg = !1, newSessionMinimize = !1, newSessionStartOver = !1, newSessionChatTranscript = !1, newSessionClose = !1, newSessionsocketConnected = !1) } function setOmnitureCookie(e, t) { var n = "https:" == window.location.protocol; document.cookie = n ? e + "=" + t + ";domain=.bell.ca;path=/;secure=true;samesite=Lax" : e + "=" + t + ";domain=.bell.ca;path=/" } function deleteOmnitureCookies() { for (var e = 0; e < omnitureCookieNames.length; e++)document.cookie = omnitureCookieNames[e] + "=;expires=" + (new Date).toUTCString() + ";domain=.bell.ca;path=/" } function setEntryPointCookie(e) { return null != getOmnitureCookie("__cepomni") && null != getOmnitureCookie("__cepomni") && "" != getOmnitureCookie("__cepomni") ? getOmnitureCookie("__cepomni") : (setOmnitureCookie("__cepomni", e), e) } function setPageCategory(e) { return null != getOmnitureCookie("__cpcpomni") && null != getOmnitureCookie("__cpcpomni") && "" != getOmnitureCookie("__cpcpomni") ? getOmnitureCookie("__cpcpomni") : (setOmnitureCookie("__cpcpomni", e), e) } $(document).on("DOMSubtreeModified", "#messages", function () { $("#messages").find("a").each(function () { var e = $(this).attr("href"), t = $(this).text(); t = t.replace(/\s/g, ""), e && "" !== e && "#" !== e && "javascript:void(0)" !== e && -1 === e.toLowerCase().indexOf("://m.bell.ca") && (e.indexOf("?") > -1 ? -1 == e.indexOf("?INT=") && -1 == e.indexOf("&INT=") && $(this).attr("href", e + "&INT=CEVA_CEVA_TXT_Echat_MASS_060121_aj_" + t) : -1 == e.indexOf("?INT=") && $(this).attr("href", e + "?INT=CEVA_CEVA_TXT_Echat_MASS_060121_aj_" + t)) }) }), $("#eChat_Bell_ContactUs_MOB, #eChat_Bell_ContactUs_INT, #eChat_Bell_ContactUs_TV , #eChat_Bell_ContactUs_HP,#eChat_Bell_MOB_Escalations, #eChat_Bell_BRS_Escalations, #eChat_Bell_EPP").on("click", function (e) { var t = this.id; "true" != getOmnitureCookie("__cwof") && (entryPointID = setEntryPointCookie(t)) }), $(document).ready(function () { $("#eChat_BELL_INIT_GA, #eChat_B_GA").on("click", function (e) { "true" != getOmnitureCookie("__cwof") && (entryPointID = setEntryPointCookie("eChat_B_GA")), "true" === getOmnitureCookie("__cwi") && 1 == counter && (setOmnitureCookie("__cabomni", "965-0-0"), chatAvailableck = !0) }) });